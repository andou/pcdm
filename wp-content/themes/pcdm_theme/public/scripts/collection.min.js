(function(){var t=function(t,i){return function(){return t.apply(i,arguments)}};window.Collection=function(){function i(i,e){var s;this.grid_ref=i,this.details_ref=e,this.onResize=t(this.onResize,this),this.onDetailsHidden=t(this.onDetailsHidden,this),this.showDetails=t(this.showDetails,this),this.onItemClick=t(this.onItemClick,this),this.switchToGrid=t(this.switchToGrid,this),this.updateDetails=t(this.updateDetails,this),this.switchToDetails=t(this.switchToDetails,this),this.onHistoryStateChange=t(this.onHistoryStateChange,this),this.is_dev=this.grid_ref.hasClass("js-dev"),this.category=this.grid_ref.attr("data-category"),s=this.grid_ref.attr("data-init-id"),this.w=$(window),this.wrapper=$("#wrapper"),this.header=this.grid_ref.find(".header-product-grid"),this.boxes=this.grid_ref.find(".item"),this.items_array=[],this.items_tot,this.current_id=null!=s&&""!==s?s:"",this.details,this.grid_scroll=0,window.is_switching=!1,event_emitter.addListener("SWITCH_TO_DETAILS",this.switchToDetails),event_emitter.addListener("UPDATE_DETAILS",this.updateDetails),event_emitter.addListener("SWITCH_TO_GRID",this.switchToGrid),event_emitter.addListener("DETAILS_HIDDEN",this.onDetailsHidden),this.setGrid(),this.setDetails(),this.has_history=!1,this.prev_state_id="home",this.is_dev||this.setHistory()}return i.prototype.setHistory=function(){return History.enabled?(this.has_history=!0,History.Adapter.bind(window,"statechange",this.onHistoryStateChange),History.replaceState({state:"home"},"","/"+this.category),""!==this.current_id?event_emitter.emitEvent("SWITCH_TO_DETAILS"):void 0):!1},i.prototype.onHistoryStateChange=function(){var t,i;return t=History.getState(),i=t.data.state,i!==this.prev_state_id?(this.prev_state_id=i,"home"===i?this.hideDetails():this.wrapper.hasClass("detail-on")?this.showDetails():this.dismantleGrid(),event_emitter.emitEvent("UPDATE_SHARING_DATA",[t.url])):void 0},i.prototype.switchToDetails=function(){return this.has_history?(History.pushState({state:this.current_id},"","/"+this.category+"/"+this.current_id),event_emitter.addListener("SWITCH_TO_GRID",this.switchToGrid)):this.dismantleGrid()},i.prototype.updateDetails=function(t){return this.current_id=t,this.has_history?(History.pushState({state:this.current_id},"","/"+this.category+"/"+this.current_id),event_emitter.addListener("SWITCH_TO_GRID",this.switchToGrid)):this.showDetails()},i.prototype.switchToGrid=function(){return this.has_history?(History.pushState({state:"home"},"","/"+this.category),event_emitter.addListener("SWITCH_TO_DETAILS",this.switchToDetails)):this.hideDetails()},i.prototype.setGrid=function(){var t,i,e,s,r,o,h,n,a,d,l;for(i=n=0,d=this.boxes.length;d>=0?d>n:n>d;i=d>=0?++n:--n)for(t=$(this.boxes[i]),h=t.offset().top,r=t.find("a"),o=a=0,l=r.length;l>=0?l>a:a>l;o=l>=0?++a:--a)s=$(r[o]),e=s.attr("data-id"),this.items_array.push({id:e,ref:s,offset:h}),s.bind("click",this.onItemClick);return this.items_tot=this.items_array.length},i.prototype.onItemClick=function(t){var i;return t.preventDefault(),is_switching?void 0:(window.is_switching=!0,i=$(t.currentTarget),this.current_id=i.attr("data-id"),event_emitter.emitEvent("SWITCH_TO_DETAILS"))},i.prototype.dismantleGrid=function(){var t,i,e,s,r,o;for(t=this.getCurrentIndex(),e=r=0,o=this.items_tot;o>=0?o>r:r>o;e=o>=0?++r:--r)s=this.items_array[e].ref,i=Math.min(Math.max(.25*(t-e),0),1.75),TweenLite.to(s,1,{css:{opacity:"0"},delay:i,ease:Power4.easeInOut});return TweenLite.to(this.header,2,{css:{opacity:"0"},ease:Power4.easeInOut}),this.grid_scroll=Math.max(this.w.scrollTop()-1e3,0),TweenLite.to(window,2,{scrollTo:{y:this.grid_scroll},ease:Power4.easeInOut,onComplete:this.showDetails})},i.prototype.rebuildGrid=function(){var t,i,e,s,r,o;for(t=this.getCurrentIndex(),e=r=0,o=this.items_tot;o>=0?o>r:r>o;e=o>=0?++r:--r)s=this.items_array[e].ref,i=Math.min(Math.max(.25*(e+5-t),0),1.75),TweenLite.to(s,1,{css:{opacity:"1"},delay:i,ease:Power4.easeInOut});return TweenLite.to(this.header,2,{css:{opacity:"1"},ease:Power4.easeInOut}),this.w.scrollTop(this.grid_scroll),TweenLite.to(window,2,{scrollTo:{y:this.getScrollById()},ease:Power4.easeInOut,onComplete:function(){return window.is_switching=!1}})},i.prototype.getScrollById=function(){var t,i,e,s,r;for(e=0,t=s=0,r=this.items_tot;r>=0?r>s:s>r;t=r>=0?++s:--s)if(i=this.items_array[t],i.id===this.current_id){e=i.offset;break}return e},i.prototype.getCurrentIndex=function(){var t,i,e,s,r;for(i=0,t=s=0,r=this.items_tot;r>=0?r>s:s>r;t=r>=0?++s:--s)e=this.items_array[t],e.id===this.current_id&&(i=t);return i},i.prototype.setDetails=function(){var t,i,e,s,r;for(e=[],t=s=0,r=this.items_tot;r>=0?r>s:s>r;t=r>=0?++s:--s)i=this.items_array[t].id,e.push(i);return this.details=new CollectionDetails(this.details_ref,e,this.is_dev)},i.prototype.showDetails=function(){return this.wrapper.hasClass("detail-on")||(this.w.scrollTop(0),this.wrapper.addClass("detail-on"),this.grid_ref.hide()),this.details.updateContents(this.current_id)},i.prototype.hideDetails=function(){return this.details.removeContents()},i.prototype.onDetailsHidden=function(t){return this.current_id=t,this.wrapper.removeClass("detail-on"),this.grid_ref.show(),this.rebuildGrid()},i.prototype.onResize=function(t,i){return this.details?this.details.onResize(t,i):void 0},i}()}).call(this);
